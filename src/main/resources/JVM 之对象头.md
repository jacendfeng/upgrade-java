# Java 对象的内存布局
在 Java 程序中，我们拥有多种新建对象的方式。
除了最为常见的 new 语句之外，我们还可以通过反射机制、Object.clone 方法、
反序列化以及 Unsafe.allocateInstance 方法来新建对象。
其中，Object.clone 方法和反序列化通过直接复制已有的数据，
来初始化新建对象的实例字段。Unsafe.allocateInstance 方法则没有初始化实例字段，
而 new 语句和反射机制，则是通过调用构造器来初始化实例字段。

# 内存布局
在 Java 虚拟机中，每个 Java 对象都有一个对象头（object header），
这个由标记字段和类型指针所构成。

其中，标记字段用以存储 Java 虚拟机有关该对象的运行数据，
如哈希码、GC 信息以及锁信息，而类型指针则指向该对象的类。


标记字段 + 类型指针 + 填充行
今天我介绍了 Java 虚拟机构造对象的方式，
所构造对象的大小，以及对象的内存布局。
常见的 new 语句会被编译为 new 指令，
以及对构造器的调用。
每个类的构造器皆会直接或者间接调用父类的构造器，
并且在同一个实例中初始化相应的字段。
Java 虚拟机引入了压缩指针的概念，将原本的 64 位指针压缩成 32 位。
压缩指针要求 Java 虚拟机堆中对象的起始地址要对齐至 8 的倍数。
Java 虚拟机还会对每个类的字段进行重排列，使得字段也能够内存对齐。
今天的实践环节比较简单，你可以使用我在工具篇中介绍过的 JOL 工具，来打印你工程中的类的字段分布情况。